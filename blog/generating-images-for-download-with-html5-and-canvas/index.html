<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.780986171a3ec41f644d.css">.banner-module--image--1QG6I{width:100%;height:100%;-o-object-fit:cover;object-fit:cover}.banner-module--imageContainer--3KrUF{position:absolute;top:0;left:0;width:100%;height:100%;overflow:hidden}.banner-module--wrapper--1xRxG{height:100%}.banner-module--header--37G4J{background:50%/cover #00003d;position:relative;padding-top:2em;padding-bottom:3em}.banner-module--container--ocgDf{position:absolute;width:100%;height:100%;top:0;left:0;background:rgba(0,0,61,.6)}.tiles-module--image--1-ejc{width:100%;height:100%;-o-object-fit:cover;object-fit:cover}.tiles-module--imageContainer--9DUT4{position:absolute;top:0;left:0;width:100%;height:100%;overflow:hidden}.tiles-module--wrapper--2oIOd{height:100%}.tiles-module--tile--2kwde{display:-webkit-flex;display:flex;-webkit-flex:1 1;flex:1 1;padding:2em;position:relative}.tiles-module--tile--2kwde a{color:#fcfcfd;text-decoration:none}.tiles-module--tile--2kwde h3,.tiles-module--tile--2kwde p{position:relative}.tiles-module--tile--2kwde h3{border-bottom:.1em dotted #fcfcfd;margin-top:0}.tiles-module--tile--2kwde .tiles-module--date--aIswY{border-top:1px solid #fcfcfd;display:inline-block}.tiles-module--tileContainer--3FpOW{width:100%;height:calc(33vw - 2em);display:-webkit-flex;display:flex;-webkit-flex-direction:row;flex-direction:row;-webkit-justify-content:stretch;justify-content:stretch;margin-top:2em;margin-bottom:2em}.tiles-module--blackout--ElFOE{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,61,.6)}.tags-module--tagsLabel--1AV4E{display:inline-block;margin-right:.5em}.tags-module--tag--3kCeK{display:inline-block;margin-right:.25em;white-space:nowrap}.tags-module--tag--3kCeK a{color:#2a2a37;text-decoration:none;border-bottom:1px dotted #2a2a37}.sourcepost-module--root--WEjHy{margin:1em -2em;padding:1em 2em;background:linear-gradient(90deg,#d0d0dc 0,#d0d0dc 8px,#eeeef2 0)}.header-module--menuLink--17w_4{margin-right:.5em;color:#fcfcfd}.header-module--active--2pIok{color:#f0194b}.header-module--root--3b321{background:#2a2a37;padding:.5em}html{box-sizing:border-box}*,:after,:before{box-sizing:inherit}html{font-family:Roboto,sans-serif}h1,h2,h3,h4,h5,h6{font-family:Open Sans,sans-serif}img{max-width:100%}body{margin:0;padding:0;background:#fcfcfd}html{font-size:16px;line-height:1.5}@media (min-width:320px){html{font-size:calc(16px + (200vw - 640px)/1046)}}@media (min-width:1366px){html{font-size:18px}}h1{font-size:2em}@media (min-width:20em){h1{font-size:calc(2em + (100vw - 20em)/50)}}@media (min-width:70em){h1{font-size:3em}}pre{overflow:scroll;background:#eeeef2;padding:.5em;margin:2em -.5em}.bodyContent{box-sizing:border-box;margin:0 auto;max-width:60em;padding-left:16px;padding-right:16px}@media (min-width:320px){.bodyContent{padding-left:calc(7.14286vw - 6.85714px)}}@media (min-width:768px){.bodyContent{padding-left:48px}}@media (min-width:320px){.bodyContent{padding-right:calc(7.14286vw - 6.85714px)}}@media (min-width:768px){.bodyContent{padding-right:48px}}hr{background:#2a2a37;border:0;height:1px;margin:0 auto;max-width:60em;overflow:visible;text-align:center}@media (min-width:20em){hr{margin-top:calc(2em + (200vw - 40em)/50)}}@media (min-width:70em){hr{margin-top:4em}}@media (min-width:20em){hr{margin-bottom:calc(2em + (200vw - 40em)/50)}}@media (min-width:70em){hr{margin-bottom:4em}}hr:after{background:#fcfcfd;content:"\2022   \2022   \2022";display:inline-block;font-size:1.4em;padding:0 .4em;position:relative;top:-.7em}hr.endPost{background:#f0194b}hr.endPost:after{color:#f0194b;content:"END";font-size:.7em;top:-1.2em}p>.gatsby-resp-image-link{width:calc(50% - .5em);float:left}p>.gatsby-resp-image-link:first-child{margin-right:1em}p>.gatsby-resp-image-link:last-child:after{content:"";display:block;float:none}p>.gatsby-resp-image-link:only-child{float:none;width:100%;margin-right:0}p>img{max-width:100%;width:auto;margin:0 auto}blockquote{position:relative;padding:1em 3.33em;margin:1em 0;background:#e3f4fb;font-style:italic}blockquote:before{content:"\201C";top:0;left:.33em}blockquote:after,blockquote:before{font-style:normal;font-family:serif;font-weight:700;position:absolute;font-size:3em;color:#00b0f0}blockquote:after{content:"\201D";bottom:0;right:.33em}.external-profiles{display:-webkit-flex;display:flex;list-style:none;margin:0;padding:0}.external-profiles li{display:-webkit-flex;display:flex;-webkit-flex:1 1 auto;flex:1 1 auto;margin:.5em;padding:1em .5em;text-align:center;border:.1em solid}.external-profiles li:first-child{margin-left:0}.external-profiles li:last-child{margin-right:0}.external-profiles li a{margin:auto}.external-profiles li svg{width:100%;height:2em}</style><meta name="generator" content="Gatsby 2.7.1"/><title data-react-helmet="true">Generating images for download with HTML5 and Canvas | Psyked: James&#x27; Web Development website</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:site" content="@psyked"/><meta data-react-helmet="true" name="twitter:creator"/><meta data-react-helmet="true" name="twitter:title" content="Generating images for download with HTML5 and Canvas"/><meta data-react-helmet="true" name="twitter:description"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-0d1baed85d93b799f22a.js"/><link as="script" rel="preload" href="/app-5022898a3648ca23d229.js"/><link as="script" rel="preload" href="/10-6e4f4a4386dbfb67ccb0.js"/><link as="script" rel="preload" href="/1-a3bf555a574ce6fc8087.js"/><link as="script" rel="preload" href="/styles-bacbbaf8eba771920982.js"/><link as="script" rel="preload" href="/webpack-runtime-7be3939bcad743edcc2e.js"/><link as="fetch" rel="preload" href="/static/d/198/path---blog-generating-images-for-download-with-html-5-and-canvas-505-948-IUajkngC623En1qRo2u77fjj3FQ.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div><header class="header-module--root--3b321"><nav class="bodyContent"><a class="header-module--menuLink--17w_4" href="/">Home</a><a class="header-module--menuLink--17w_4" href="/blog/">Blog Archive</a></nav></header><main><header class="banner-module--header--37G4J"><div class="banner-module--container--ocgDf"></div><div class="bodyContent" style="color:white;position:relative"><header><h1>Generating images for download with HTML5 and Canvas</h1></header><aside>Published: <!-- -->01 May 2017</aside></div></header><div class="bodyContent"><div><h2>Summary</h2>
<p>With a clever bit of trickery from HTML5 and JavaScript, it is possible to trigger a browser download of anything that can be generated in a canvas element, regardless of whether that element is visible or not. This works in modern <a href="https://caniuse.com/#feat=download">browsers which support the 'download' attribute</a> and <a href="https://caniuse.com/#feat=canvas">which support the 'canvas' element.</a></p>
<h2>Introduction</h2>
<p>In most browsers a canvas image can already be natively saved through the right-click menu, and what this technique is doing is essentially automating, or forcing, this action on the users' behalf. One of the advantages with this technique - besides the improved user experience - is that you have a chance to cleanly re-render the canvas element and essentially modify the output before the browser begins saving the image. </p>
<p>This means you can adjust the resolution, the aspect ratio, add watermarks or even modify the image data before it's downloaded by the user. Of course, the original right-click menu and functionality still exists, so you can't use this as a method of stopping users from saving your images completely, but it does mean that you can give them a better experience using your website.</p>
<h2>Real-world example</h2>
<p>I've used this technique on <a href="https://www.pokeproject.co.uk/">PokéProject</a>, with what I call the <a href="https://www.pokeproject.co.uk/instagram/">'Highresinator'.</a> PokéProject takes the pixel art from the original Pokémon GameBoy games, and scales it up from the original 32x32 pixel images into wallpaper backgrounds for desktop computers or mobile devices.</p>
<p><a href="https://www.pokeproject.co.uk/instagram/gengar"><img src="/content/images/2017/04/pokeproject.png" alt="Real world example on PokéProject"></a></p>
<p>As you can see in the image above, as part of this process I'm generating a canvas-based preview of the wallpaper image, but that preview canvas isn't the correct resolution for any downloads. To fix this I've added a short form with download buttons, and clicking any of those buttons will generate the artwork shown on the canvas at the specified resolution.</p>
<p><img src="/content/images/2017/04/downloadpokeproject.gif" alt="Animated example of PokéProject"></p>
<h2>Example code</h2>
<p>The key steps to this process are simple. First you have to generate an off-screen canvas element, into which you draw your image, and then you create an anchor element with a download attribute, transfer the users' click event to this element, and a download will be triggered.</p>
<p>Let's look at some sample code. </p>
<p>First, we're going to need a simple website which contains a canvas element:</p>
<pre><code>&#x3C;html>
    &#x3C;head>
        &#x3C;title>Canvas Downloads&#x3C;/title>
    &#x3C;/head>
    &#x3C;body>
        &#x3C;canvas id="myCanvas" width="100" height="100">&#x3C;/canvas>
        &#x3C;a id="downloadLink" href="#">Download Canvas&#x3C;/a>
    &#x3C;/body>
&#x3C;/html>
</code></pre>
<p>Next we use JavaScript to render something simple on the canvas - a bright red box, for example:</p>
<pre><code>&#x3C;script>
    var canvasElement = document.getElementById('myCanvas')
    var drawingContext = canvasElement.getContext('2d')
    drawingContext.fillStyle = '#ff0000'
    drawingContext.fillRect(10, 10, 80, 80)
&#x3C;/script>
</code></pre>
<p><img src="/content/images/2017/04/preview.png" alt="Demo preview"></p>
<p>That works, but it's not very reusable - so let's refactor it a little:</p>
<pre><code>&#x3C;script>
    function renderCanvas(canvasElement) {
        var drawingContext = canvasElement.getContext('2d')
        drawingContext.fillStyle = '#ff0000'
        drawingContext.fillRect(10, 10, 80, 80)
    }
    var canvasElement = document.getElementById('myCanvas')
    renderCanvas(canvasElement)
&#x3C;/script>
</code></pre>
<p>That's a bit more reusable - we're still doing the same actions, but we've made the canvas element that we draw to reusable.</p>
<p><img src="/content/images/2017/04/rightclickpreview.png" alt="Demo right click preview"></p>
<p>Our users can currently right click on the canvas element and save it locally. Let's add a button which will perform this action for them automatically.</p>
<pre><code>&#x3C;script>
    function renderCanvas(canvasElement) {
        var drawingContext = canvasElement.getContext('2d')
        drawingContext.fillStyle = '#ff0000'
        drawingContext.fillRect(10, 10, 80, 80)
    }
    var canvasElement = document.getElementById('myCanvas')
    renderCanvas(canvasElement)

    var linkElement = document.getElementById('downloadLink')
    linkElement.addEventListener('click', function() {
        var newCanvas = document.createElement('canvas')
        newCanvas.width = 100
        newCanvas.height = 100

        renderCanvas(newCanvas)

        let fakeDownloadElement = document.createElement('a')
        document.body.appendChild(fakeDownloadElement)
        fakeDownloadElement.setAttribute('href', newCanvas.toDataURL('image/png', 1.0))
        fakeDownloadElement.setAttribute('download', 'red-square.png')
        fakeDownloadElement.style.display = ''

        fakeDownloadElement.click()

        document.body.removeChild(element)
    })
&#x3C;/script>
</code></pre>
<p>That's a lot of new code, but there's a few simple steps to this process:</p>
<ol>
<li>We create a new canvas DOM element, which is not added to the main page DOM and therefore is not visible.</li>
<li>We re-use our original canvas drawing logic, to draw a red box into our new (invisible) canvas element</li>
<li>We create a hyperlink element in the page DOM, set the element URL to be an bytedata representation of the canvas element (in png format as well, for transparency)</li>
<li>We set the 'download' attribute on the new element, specifying the download filename <em>and</em> changing the default browser behaviour and have it download the data as a file rather than trying to navigate to an URL</li>
<li>We fake a click event on our new hyperlink element, to trigger the file save</li>
<li>We remove the link element from the DOM and clean up afterwards</li>
</ol>
<p><img src="/content/images/2017/04/canvaspreview-2.gif" alt="Canvas download image preview"></p>
<p>This code is currently just saving exactly what's in the canvas. Let's make things a little more interesting - we're going to change the size of the download and the colour of the box.</p>
<pre><code>&#x3C;script>
    function renderCanvas(canvasElement, colour) {
        var drawingContext = canvasElement.getContext('2d')
        drawingContext.fillStyle = colour
        drawingContext.fillRect(10, 10, canvasElement.width - 20, canvasElement.height - 20)
    }
    var canvasElement = document.getElementById('myCanvas')
    renderCanvas(canvasElement, '#ff0000')

    var linkElement = document.getElementById('downloadLink')
    linkElement.addEventListener('click', function() {
        var newCanvas = document.createElement('canvas')
        newCanvas.width = 320
        newCanvas.height = 240

        renderCanvas(newCanvas, '#00ff00')

        let fakeDownloadElement = document.createElement('a')
        document.body.appendChild(fakeDownloadElement)
        fakeDownloadElement.setAttribute('href', newCanvas.toDataURL('image/png', 1.0))
        fakeDownloadElement.setAttribute('download', 'green-rectangle.png')
        fakeDownloadElement.style.display = ''

        fakeDownloadElement.click()

        document.body.removeChild(element)
    })
&#x3C;/script>
</code></pre>
<p>What we've done here is change the render function slightly, so that it takes a colour parameter to the render function, and we've changed the box drawing logic, so that it draws a rectangle inside the edges of the canvas, regardless of the canvas size. </p>
<p>A user will now see a preview of a red box, but if they click on the download link, they'll get a green rectangle downloaded instead. They could still click on the original canvas and save that of course, but that's not the point of this exercise, and there are other ways of preventing that behaviour.</p>
<p><img src="/content/images/2017/04/canvaspreview.gif" alt="Canvas download image preview"></p>
<p>We've achieved all of this on the client-side - no server-based image generation at all. This is the logic which underpins the wallpaper downloads of PokéProject <a href="https://www.pokeproject.co.uk/">[link]</a>, which has a number of pre-set image download links at fixed and custom resolutions.</p>
<p><a href="https://codepen.io/psyked/pen/WjpaMQ">You can see a working example on CodePen.</a></p></div><hr class="endPost"/><aside></aside><aside><span class="tags-module--tagsLabel--1AV4E">Tagged as:</span><span class="tags-module--tag--3kCeK"><a href="/tag/html5">html5</a><span>, </span></span><span class="tags-module--tag--3kCeK"><a href="/tag/javascript">javascript</a><span>, </span></span><span class="tags-module--tag--3kCeK"><a href="/tag/canvas">canvas</a></span></aside></div><aside class="bodyContent tiles-module--tileContainer--3FpOW"><section class="tiles-module--tile--2kwde"><a href="/blog/uploading-files-to-trello-with-node-js/"><div class="tiles-module--blackout--ElFOE"></div><h3>Uploading files to Trello with Node.js</h3><p></p><p class="tiles-module--date--aIswY">18 May 2017</p></a></section><section class="tiles-module--tile--2kwde"><a href="/blog/how-to-effectively-kill-your-agile-team/"><aside class="tiles-module--imageContainer--9DUT4"><div class="tiles-module--wrapper--2oIOd gatsby-image-wrapper" style="position:relative;overflow:hidden"><div style="width:100%;padding-bottom:66.66666666666667%"></div><img src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAv/EABYBAQEBAAAAAAAAAAAAAAAAAAIBA//aAAwDAQACEAMQAAABvQya53GRH//EABoQAAIDAQEAAAAAAAAAAAAAAAECAAMyEiH/2gAIAQEAAQUCdiqm5xB6LMdQZ//EABYRAAMAAAAAAAAAAAAAAAAAAAEQMf/aAAgBAwEBPwERf//EABYRAAMAAAAAAAAAAAAAAAAAAAEQMf/aAAgBAgEBPwE1f//EABsQAAIBBQAAAAAAAAAAAAAAAAABEBEhMnGR/9oACAEBAAY/ArKpguicMWj/xAAbEAEAAgIDAAAAAAAAAAAAAAABABEhMUGRof/aAAgBAQABPyEAkrqmII4YVptLi9EGOrZzH0p//9oADAMBAAIAAwAAABAMP//EABYRAQEBAAAAAAAAAAAAAAAAAAEAMf/aAAgBAwEBPxAjHb//xAAVEQEBAAAAAAAAAAAAAAAAAAABAP/aAAgBAgEBPxBML//EABwQAQACAwADAAAAAAAAAAAAAAEAESExQWHR8P/aAAgBAQABPxBEhNijMuAPL6jEAGg5ZHAmyWCkoUXufUcJ/9k=" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><img loading="lazy" sizes="(max-width: 630px) 100vw, 630px" srcset="/static/1548c08565e7b44b04e25d68db770f12/10bdc/1*NqOR1hq5mkjoR2AwRceUSQ.jpg 158w,
/static/1548c08565e7b44b04e25d68db770f12/f4ab0/1*NqOR1hq5mkjoR2AwRceUSQ.jpg 315w,
/static/1548c08565e7b44b04e25d68db770f12/30037/1*NqOR1hq5mkjoR2AwRceUSQ.jpg 630w,
/static/1548c08565e7b44b04e25d68db770f12/9810d/1*NqOR1hq5mkjoR2AwRceUSQ.jpg 945w,
/static/1548c08565e7b44b04e25d68db770f12/81ef8/1*NqOR1hq5mkjoR2AwRceUSQ.jpg 1200w" src="/static/1548c08565e7b44b04e25d68db770f12/30037/1*NqOR1hq5mkjoR2AwRceUSQ.jpg" alt="" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div></aside><div class="tiles-module--blackout--ElFOE"></div><h3>How to effectively kill your Agile Team</h3><p>Agile methodology is the glorious present and future of software development, but the correct set of circumstances can seriously cripple a…</p><p class="tiles-module--date--aIswY">26 Apr 2017</p></a></section></aside></main><footer id="footer"></footer></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"blog-generating-images-for-download-with-html-5-and-canvas-505","path":"/blog/generating-images-for-download-with-html5-and-canvas/"};window.dataPath="198/path---blog-generating-images-for-download-with-html-5-and-canvas-505-948-IUajkngC623En1qRo2u77fjj3FQ";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-5022898a3648ca23d229.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-0d1baed85d93b799f22a.js"],"component---src-templates-tag-list-template-js":["/component---src-templates-tag-list-template-js-8ac8c81aa9e8f14ee86f.js"],"component---src-pages-blog-jsx":["/component---src-pages-blog-jsx-f813ec5eae653715f627.js"],"component---src-pages-index-jsx":["/component---src-pages-index-jsx-2371563e07de55cabc43.js"],"component---src-pages-tags-jsx":["/component---src-pages-tags-jsx-07ed265e7724ed4795e0.js"],"pages-manifest":["/pages-manifest-22b74fcd60953ccc174a.js"]};/*]]>*/</script><script src="/webpack-runtime-7be3939bcad743edcc2e.js" async=""></script><script src="/styles-bacbbaf8eba771920982.js" async=""></script><script src="/1-a3bf555a574ce6fc8087.js" async=""></script><script src="/10-6e4f4a4386dbfb67ccb0.js" async=""></script><script src="/app-5022898a3648ca23d229.js" async=""></script><script src="/component---src-templates-blog-post-js-0d1baed85d93b799f22a.js" async=""></script></body></html>